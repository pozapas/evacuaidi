<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="EvacuAIDi: An AI-Driven, Causal-Informed Framework for Probabilistic and Disability-Inclusive Evacuation Guidance - PhD Dissertation by Amir Rafe">
    <meta name="keywords" content="AI evacuation, disability-inclusive design, emergency evacuation, fire safety, building safety, PhD dissertation">
    <meta name="author" content="Amir Rafe">
    <title>EvacuAIDi: An AI-Driven, Causal-Informed Framework for Probabilistic and Disability-Inclusive Evacuation Guidance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Load Configuration Files Early -->
    <script src="config.js"></script>
    <script src="env-config.js"></script>
    
    <!-- Professional Academic Design System -->
    <style>
        :root {
            --primary-blue: #1e40af;
            --secondary-blue: #3b82f6;
            --accent-teal: #0d9488;
            --warm-gray: #78716c;
            --light-gray: #f8fafc;
            --dark-gray: #1f2937;
            --success-green: #059669;
            --warning-orange: #d97706;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--dark-gray);
            line-height: 1.6;
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 50%, var(--accent-teal) 100%);
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }
        
        .nav-link {
            position: relative;
            transition: all 0.3s ease;
            color: var(--warm-gray);
        }
        
        .nav-link:hover, .nav-link.active {
            color: var(--primary-blue);
        }
        
        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-blue), var(--accent-teal));
            transition: width 0.3s ease;
        }
        
        .nav-link:hover::after,
        .nav-link.active::after {
            width: 100%;
        }
        
        .contribution-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .contribution-card:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: var(--secondary-blue);
        }
        
        .spinner {
            border: 4px solid rgba(59, 130, 246, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border-left-color: var(--secondary-blue);
            animation: spin 1s ease infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .methodology-step {
            position: relative;
            padding: 2rem;
            margin-bottom: 2rem;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .methodology-step::before {
            content: attr(data-step);
            position: absolute;
            top: -15px;
            left: 2rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-blue));
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .finding-highlight {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid var(--warning-orange);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        .result-stat {
            background: linear-gradient(135deg, #dcfdf7 0%, #a7f3d0 100%);
            border: 2px solid var(--success-green);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .chat-message {
            animation: fadeInUp 0.5s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .research-highlight {
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
            border-left: 4px solid #7c3aed;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }
        
        /* Modal styles for plot enlargement */
        .plot-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
        }
        
        .plot-modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90vw;
            max-height: 90vh;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .plot-modal img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        .plot-modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .plot-modal-close:hover {
            color: #000;
            background: rgba(255, 255, 255, 1);
        }
        
        .plot-clickable {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .plot-clickable:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body class="antialiased">
    <!-- Header & Navigation -->
    <header id="header" class="bg-white/95 backdrop-blur-lg sticky top-0 z-50 shadow-lg border-b border-gray-100">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-teal-500 rounded-xl flex items-center justify-center">
                    <span class="text-white font-bold text-lg">E</span>
                </div>
                <h1 class="text-2xl font-bold">
                    <span class="text-gray-800">Evacu</span><span class="bg-gradient-to-r from-blue-600 to-teal-500 bg-clip-text text-transparent">AIDi</span>
                </h1>
            </div>
            <div class="hidden lg:flex space-x-8">
                <a href="#overview" class="nav-link">Overview</a>
                <a href="#methodology" class="nav-link">Methodology</a>
                <a href="#findings" class="nav-link">Key Findings</a>
                <a href="#implications" class="nav-link">Implications</a>
                <a href="#chat" class="nav-link">Ask AI Researcher ✨</a>
            </div>
            <div class="flex items-center space-x-4">
                <a href="https://github.com/pozapas" target="_blank" class="hidden md:flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-blue-700 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all duration-300">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path>
                    </svg>
                    <span>GitHub</span>
                </a>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="hero-gradient text-white py-20 lg:py-32">
            <div class="container mx-auto px-6 text-center">
                <div class="max-w-5xl mx-auto">
                    <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold leading-tight mb-6">
                        <span class="block bg-gradient-to-r from-yellow-200 to-green-200 bg-clip-text text-transparent">
                            EvacuAIDi:
                        </span>
                        <span class="block text-white mt-2">
                            An AI-Driven, Causal-Informed Framework for Probabilistic and Disability-Inclusive Evacuation Guidance
                        </span>
                    </h1>
                    <p class="text-xl md:text-2xl font-light text-blue-100 max-w-4xl mx-auto mb-8 leading-relaxed">
                        A comprehensive AI-driven framework to revolutionize building evacuations through standards-compliant automation, disability-inclusive modeling, causal evaluation, and probabilistic risk assessment.
                    </p>
                    <div class="mt-10 flex flex-col sm:flex-row gap-4 justify-center">
                        <a href="#overview" class="bg-white text-blue-600 px-8 py-4 rounded-full font-semibold text-lg hover:bg-blue-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105">
                            Explore the Research
                        </a>
                        <a href="#chat" class="border-2 border-white text-white px-8 py-4 rounded-full font-semibold text-lg hover:bg-white hover:text-blue-600 transition-all duration-300">
                            Ask AI Researcher ✨
                        </a>
                    </div>
                    <div class="mt-12 text-center">
                        <p class="text-blue-200 text-sm uppercase tracking-wider font-medium">PhD Dissertation 2025</p>
                        <p class="text-blue-100 font-semibold">Amir Rafe • Utah State University</p>
                        <p class="text-blue-200 text-sm mt-2">
                            Conducted under the supervision of 
                            <a href="https://engineering.usu.edu/cee/people/faculty/singleton-patrick" target="_blank" class="text-yellow-200 hover:text-yellow-100 underline font-semibold transition-colors">
                                Dr. Patrick Singleton
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Overview Section -->
        <section id="overview" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Research Overview</h2>
                    <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                        This dissertation addresses critical gaps in evacuation science through four interconnected research contributions that form the comprehensive EvacuAIDi framework.
                    </p>
                </div>

                <!-- Research Problems -->
                <div class="mb-20">
                    <h3 class="text-3xl font-bold text-center text-gray-800 mb-12">The Critical Research Gaps</h3>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">🔧</div>
                            <h4 class="text-2xl font-bold mb-4 text-gray-800">Standards-Compliant Evacuation Simulation Inputs Generation</h4>
                            <p class="text-gray-600 leading-relaxed mb-4">
                                Most existing simulation workflows rely on manual extraction of parameters from fire safety codes (e.g., NFPA 101, SFPE), which is error-prone and lacks causal traceability. This creates inconsistencies across studies and weakens the credibility of simulation results.
                            </p>
                            <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                                <p class="text-red-700 font-semibold text-sm">
                                    <strong>Gap:</strong> There is no widely adopted, automated pipeline to extract, reason over, and validate evacuation input parameters in a way that guarantees both standards compliance and causal coherence.
                                </p>
                            </div>
                        </div>
                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">👥</div>
                            <h4 class="text-2xl font-bold mb-4 text-gray-800">Disability-Inclusive Behavioral Fidelity</h4>
                            <p class="text-gray-600 leading-relaxed mb-4">
                                While many evacuation models include agents with reduced mobility or altered walking speeds, few go beyond kinematic simplifications. Key behavioral aspects, such as leadership dynamics, marshal guidance, and probabilistic compliance, are poorly captured for individuals with disabilities.
                            </p>
                            <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                                <p class="text-red-700 font-semibold text-sm">
                                    <strong>Gap:</strong> There is a critical need for empirically calibrated models that realistically simulate both the physical constraints and behavioral responses of heterogeneous groups, including disabled individuals.
                                </p>
                            </div>
                        </div>
                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">📊</div>
                            <h4 class="text-2xl font-bold mb-4 text-gray-800">Causal and Probabilistic Evaluation of AI Guidance</h4>
                            <p class="text-gray-600 leading-relaxed mb-4">
                                Studies that consider AI guidance during evacuation frequently rely on deterministic assumptions and average-case analyses, failing to account for uncertainty in key behavioral factors such as occupant compliance, as well as contextual variables like occupant load.
                            </p>
                            <div class="bg-red-50 border-l-4 border-red-400 p-4 rounded">
                                <p class="text-red-700 font-semibold text-sm">
                                    <strong>Gap:</strong> A robust, scenario-aware framework for evaluating the causal and probabilistic impact of AI guidance on evacuation safety under uncertainty remains underdeveloped.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Research Questions -->
                <div class="research-highlight rounded-2xl">
                    <h3 class="text-2xl font-bold text-purple-800 mb-4">Central Research Questions</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <p class="font-semibold text-purple-700 mb-2">RQ1: Automated Simulation Parameters Extraction</p>
                            <p class="text-purple-600">How can AI be leveraged to automate the extraction of simulation parameters from complex regulatory documents to ensure that models are both standardscompliant and causally coherent?</p>
                        </div>
                        <div>
                            <p class="font-semibold text-purple-700 mb-2">RQ2: Disability-Inclusive Behavioral Modeling</p>
                            <p class="text-purple-600">How can agent-based models be enhanced to realistically simulate the evacuation dynamics of a heterogeneous crowd, including individuals with disabilities, by incorporating empirically-derived social and behavioral forces?</p>
                        </div>
                        <div>
                            <p class="font-semibold text-purple-700 mb-2">RQ3: Causal Impact of AI Guidance Compliance</p>
                            <p class="text-purple-600">What is the quantifiable causal effect of occupant compliance with a personalized, accessibility-aware AI guidance system on evacuation performance across a range of hazard scenarios?</p>
                        </div>
                        <div>
                            <p class="font-semibold text-purple-700 mb-2">RQ4: Probabilistic Risk Assessment Framework</p>
                            <p class="text-purple-600">How can a probabilistic framework be used to formally integrate uncertainty in human compliance and occupant load to produce a robust assessment of evacuation risk?</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Methodology Section -->
        <section id="methodology" class="py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Research Architecture</h2>
                </div>

                <div class="max-w-6xl mx-auto space-y-8">
                    <!-- Chapter 1: Introduction -->
                    <div class="methodology-step" data-step="Chapter 1">
                        <div class="grid md:grid-cols-3 gap-8 items-center">
                            <div class="md:col-span-2">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">Introduction & Problem Formulation</h3>
                                <p class="text-gray-600 mb-4 leading-relaxed">
                                    Established the critical need for AI-driven, disability-inclusive evacuation systems by identifying major gaps in current evacuation modeling approaches and defining the four primary research questions.
                                </p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">Problem Definition</span>
                                    <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">Research Questions</span>
                                    <span class="bg-gray-100 text-gray-800 px-3 py-1 rounded-full text-sm font-medium">Framework Overview</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-2xl p-4 shadow-lg">
                                <img src="Plots/1/dissertation_structure.png" alt="Dissertation Structure" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                <p class="text-xs text-gray-500 mt-2 text-center">Research Framework Structure</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 2: Literature Review -->
                    <div class="methodology-step" data-step="Chapter 2">
                        <div class="grid md:grid-cols-3 gap-8 items-center">
                            <div class="md:col-span-2">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">Literature Review: Who Leads, Who Follows?</h3>
                                <p class="text-gray-600 mb-4 leading-relaxed">
                                    Systematic review of 233 peer-reviewed studies on evacuation guidance and leader-follower dynamics, covering human-led, environmental, technological, and hybrid guidance systems to establish the theoretical foundation.
                                </p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">Systematic Review</span>
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">Leader-Follower Dynamics</span>
                                    <span class="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-medium">233 Studies</span>
                                </div>
                            </div>
                            <div class="bg-white rounded-2xl p-4 shadow-lg">
                                <img src="Plots/2/1.png" alt="Literature Review Summary" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                <p class="text-xs text-gray-500 mt-2 text-center">Literature Classification Framework</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 3: AI Knowledge Extraction -->
                    <div class="methodology-step" data-step="Chapter 3">
                        <div class="space-y-6">
                            <div class="flex justify-between items-start">
                                <div class="flex-grow pr-8">
                                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Causal AI for Evacuation Modeling</h3>
                                    <p class="text-gray-600 mb-4 leading-relaxed">
                                        Developed an AI pipeline that automatically parses regulatory documents (NFPA 101, SFPE Handbook, BS-9999, etc.) using fine-tuned LLM, GraphRAG, and causal reasoning to generate simulation-ready parameters with 92%+ accuracy.
                                    </p>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Fine-tuned Gemma 3</span>
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Neo4j GraphRAG</span>
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Causal Inference</span>
                                    </div>
                                </div>
                                <div class="result-stat flex-shrink-0">
                                    <div class="text-2xl font-bold text-green-700 mb-1">92%+</div>
                                    <div class="text-xs text-green-600 font-medium">Parameter Extraction Accuracy</div>
                                </div>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/3/fig1_training_dynamics.png" alt="Training dynamics of the fine-tuned Gemma 3 (4B) model" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Training dynamics of the fine-tuned Gemma 3 (4B) model</p>
                                </div>
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/3/plot4_category_performance.png" alt="Performance of four LLMs across evacuation-related question categories" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Performance of four LLMs across evacuation-related question categories</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 4: DiSFM-GS Model -->
                    <div class="methodology-step" data-step="Chapter 4">
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">Disability-Inclusive Social Force Model (DiSFM-GS)</h3>
                                <p class="text-gray-600 mb-4 leading-relaxed">
                                    Enhanced agent-based modeling by incorporating empirically-calibrated parameters for individuals with disabilities, using RFID trajectory data from controlled evacuation drills in a 4-story university building.
                                </p>
                                <div class="flex flex-wrap gap-2">
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">Social Force Model</span>
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">Transfer Entropy</span>
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">RFID Data</span>
                                </div>
                            </div>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/4/fig_walking_speed_analysis.png" alt="Walking Speed Analysis" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Walking Speed Analysis</p>
                                </div>
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/4/follow_rate_histogram.png" alt="Leader-following rates" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Leader-following rates</p>
                                </div>
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/4/objective_convergence.png" alt="Objective function convergence" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Objective function convergence</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 5: Causal Evaluation -->
                    <div class="methodology-step" data-step="Chapter 5">
                        <div class="space-y-6">
                            <div class="flex justify-between items-start">
                                <div class="flex-grow pr-8">
                                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Causal-Intervention Scenario Design (CISD)</h3>
                                    <p class="text-gray-600 mb-4 leading-relaxed">
                                        Used counterfactual simulations and Pearl's do-calculus to isolate the causal impact of AI guidance compliance on evacuation performance, demonstrating a 22.5% reduction in evacuation time across diverse scenarios.
                                    </p>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-sm font-medium">Counterfactual Analysis</span>
                                        <span class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-sm font-medium">A* Pathfinding</span>
                                        <span class="bg-teal-100 text-teal-800 px-3 py-1 rounded-full text-sm font-medium">Pearl's do-calculus</span>
                                    </div>
                                </div>
                                <div class="result-stat flex-shrink-0">
                                    <div class="text-2xl font-bold text-green-700 mb-1">22.5%</div>
                                    <div class="text-xs text-green-600 font-medium">Evacuation Time Reduction</div>
                                </div>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/5/figure_2_posterior_evolution.png" alt="Posterior Evolution" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Posterior Evolution</p>
                                </div>
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/5/figure_3_compliance_impact.png" alt="Compliance Impact Analysis" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Compliance Impact Analysis</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 6: Bayesian Risk Framework -->
                    <div class="methodology-step" data-step="Chapter 6">
                        <div class="space-y-6">
                            <div class="flex justify-between items-start">
                                <div class="flex-grow pr-8">
                                    <h3 class="text-2xl font-bold text-gray-800 mb-4">Hierarchical Bayesian Risk Framework</h3>
                                    <p class="text-gray-600 mb-4 leading-relaxed">
                                        Developed probabilistic risk assessment integrating uncertainty in compliance and occupant load using Gaussian Process surrogates and Global Sensitivity Analysis, identifying occupant load as the primary risk driver (57% of variance).
                                    </p>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">Bayesian MCMC</span>
                                        <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">Gaussian Process</span>
                                        <span class="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">Sobol Sensitivity</span>
                                    </div>
                                </div>
                                <div class="result-stat flex-shrink-0">
                                    <div class="text-2xl font-bold text-green-700 mb-1">57%</div>
                                    <div class="text-xs text-green-600 font-medium">Risk Variance from Occupant Load</div>
                                </div>
                            </div>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/6/fig_5_1_trace.png" alt="MCMC Trace Plots" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">MCMC Trace Plots</p>
                                </div>
                                <div class="bg-white rounded-2xl p-4 shadow-lg">
                                    <img src="Plots/6/parameter_sensitivity_ranking.png" alt="Parameter Sensitivity Ranking" class="w-full h-auto rounded-lg plot-clickable" onclick="openPlotModal(this)">
                                    <p class="text-xs text-gray-500 mt-2 text-center">Parameter Sensitivity Ranking</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Chapter 7: Conclusions -->
                    <div class="methodology-step" data-step="Chapter 7">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">Conclusions & Future Directions</h3>
                            <p class="text-gray-600 mb-4 leading-relaxed">
                                Synthesized research contributions, quantified stakeholder implications, and outlined future research directions including integration with CFD models, multimodal guidance systems, and dynamic trust modeling.
                            </p>
                            <div class="flex flex-wrap gap-2 mb-4">
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Research Synthesis</span>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Stakeholder Implications</span>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Future Research</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Key Findings Section -->
        <section id="findings" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Key Research Findings</h2>
                    <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                        Empirical results demonstrating the effectiveness and impact of the EvacuAIDi framework across multiple dimensions.
                    </p>
                </div>

                <div class="grid lg:grid-cols-2 gap-12 max-w-6xl mx-auto">
                    <!-- Major Finding 1 -->
                    <div class="finding-highlight">
                        <h3 class="text-2xl font-bold text-orange-800 mb-4">🎯 Causal Impact of AI Guidance</h3>
                        <div class="text-4xl font-bold text-orange-700 mb-2">22.5%</div>
                        <p class="text-orange-700 font-semibold mb-3">Reduction in mean evacuation time</p>
                        <p class="text-orange-600">
                            Increasing AI compliance from 10% to 70% causes a statistically significant 22.5% reduction in evacuation time, with diminishing returns beyond 50% compliance.
                        </p>
                    </div>

                    <!-- Major Finding 2 -->
                    <div class="finding-highlight">
                        <h3 class="text-2xl font-bold text-orange-800 mb-4">♿ Equity Enhancement</h3>
                        <div class="text-4xl font-bold text-orange-700 mb-2">15.9%</div>
                        <p class="text-orange-700 font-semibold mb-3">Stronger benefit for vulnerable populations</p>
                        <p class="text-orange-600">
                            AI guidance provides 15.9% greater benefits for individuals with disabilities, actively helping to close the safety gap and promote equity.
                        </p>
                    </div>

                    <!-- Major Finding 3 -->
                    <div class="finding-highlight">
                        <h3 class="text-2xl font-bold text-orange-800 mb-4">📊 Primary Risk Drivers</h3>
                        <div class="flex items-center space-x-4 mb-3">
                            <div>
                                <div class="text-3xl font-bold text-orange-700">57%</div>
                                <div class="text-sm text-orange-600">Occupant Load</div>
                            </div>
                            <div>
                                <div class="text-3xl font-bold text-orange-700">29%</div>
                                <div class="text-sm text-orange-600">AI Compliance</div>
                            </div>
                        </div>
                        <p class="text-orange-600">
                            Global Sensitivity Analysis identifies these two factors as primary drivers of evacuation risk variance.
                        </p>
                    </div>

                    <!-- Major Finding 4 -->
                    <div class="finding-highlight">
                        <h3 class="text-2xl font-bold text-orange-800 mb-4">🤖 LLM Performance</h3>
                        <div class="text-4xl font-bold text-orange-700 mb-2">92%+</div>
                        <p class="text-orange-700 font-semibold mb-3">Parameter extraction accuracy</p>
                        <p class="text-orange-600">
                            The RAG pipeline achieves over 92% accuracy in extracting simulation parameters from regulatory documents.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Implications Section -->
        <section id="implications" class="py-20 bg-gray-50">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Research Implications & Future Directions</h2>
                    <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                        Transforming evacuation science through actionable insights for stakeholders and comprehensive recommendations for future research.
                    </p>
                </div>

                <!-- Stakeholder Implications -->
                <div class="mb-20">
                    <h3 class="text-3xl font-bold text-center text-gray-800 mb-12">Implications for Key Stakeholders</h3>
                    <div class="grid lg:grid-cols-3 gap-8 max-w-6xl mx-auto">
                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">👷‍♂️</div>
                            <h4 class="text-xl font-bold mb-4 text-gray-800">For Fire Safety Engineers</h4>
                            <ul class="text-gray-600 space-y-2">
                                <li class="flex items-start">
                                    <span class="text-blue-500 mr-2 mt-1">•</span>
                                    <span>Reproducible, causally-defensible simulation inputs</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-blue-500 mr-2 mt-1">•</span>
                                    <span>Inclusive performance-based design tools</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-blue-500 mr-2 mt-1">•</span>
                                    <span>Strengthened reliability of safety cases</span>
                                </li>
                            </ul>
                        </div>

                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">🏢</div>
                            <h4 class="text-xl font-bold mb-4 text-gray-800">For Building Managers</h4>
                            <ul class="text-gray-600 space-y-2">
                                <li class="flex items-start">
                                    <span class="text-purple-500 mr-2 mt-1">•</span>
                                    <span>Clear justification for AI guidance investment</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-purple-500 mr-2 mt-1">•</span>
                                    <span>Integration with real-time sensor networks</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-purple-500 mr-2 mt-1">•</span>
                                    <span>Enhanced vertical evacuation infrastructure</span>
                                </li>
                            </ul>
                        </div>

                        <div class="contribution-card rounded-2xl p-8 card-hover">
                            <div class="text-6xl mb-6 text-center">💻</div>
                            <h4 class="text-xl font-bold mb-4 text-gray-800">For Software Developers</h4>
                            <ul class="text-gray-600 space-y-2">
                                <li class="flex items-start">
                                    <span class="text-teal-500 mr-2 mt-1">•</span>
                                    <span>Blueprint for next-generation simulation tools</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-teal-500 mr-2 mt-1">•</span>
                                    <span>Validated inclusive agent profiles</span>
                                </li>
                                <li class="flex items-start">
                                    <span class="text-teal-500 mr-2 mt-1">•</span>
                                    <span>Robust probabilistic assessment features</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Technology Recommendations -->
                <div class="mb-20">
                    <h3 class="text-3xl font-bold text-center text-gray-800 mb-12">Technology Integration Recommendations</h3>
                    <div class="grid md:grid-cols-2 gap-8 max-w-6xl mx-auto">
                        <div class="bg-white rounded-2xl p-8 border-l-4 border-blue-500">
                            <h4 class="text-xl font-bold text-blue-800 mb-4">🤖 Occupant Evacuation Elevators (OEEs)</h4>
                            <p class="text-gray-600 mb-4">
                                Integrate AI guidance with NFPA 101-compliant OEEs for seamless vertical evacuation of individuals with disabilities.
                            </p>
                            <ul class="text-gray-600 space-y-2">
                                <li>• Real-time capacity and status monitoring</li>
                                <li>• Dynamic routing based on occupant mobility profiles</li>
                                <li>• Automated dispatch coordination</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 border-l-4 border-purple-500">
                            <h4 class="text-xl font-bold text-purple-800 mb-4">📡 Real-Time Sensing Integration</h4>
                            <p class="text-gray-600 mb-4">
                                Deploy multi-modal sensor networks to provide AI systems with live situational awareness.
                            </p>
                            <ul class="text-gray-600 space-y-2">
                                <li>• LiDAR for precise occupant counting and density</li>
                                <li>• Thermal cameras for smoke-obscured visibility</li>
                                <li>• Wi-Fi/Bluetooth for crowd movement patterns</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 border-l-4 border-teal-500">
                            <h4 class="text-xl font-bold text-teal-800 mb-4">🏠 Smart Areas of Refuge</h4>
                            <p class="text-gray-600 mb-4">
                                Transform static Areas of Refuge into intelligent, AI-managed safe zones with dynamic capacity management.
                            </p>
                            <ul class="text-gray-600 space-y-2">
                                <li>• Real-time occupancy monitoring</li>
                                <li>• Automated first responder notification</li>
                                <li>• Priority-based occupant routing</li>
                            </ul>
                        </div>

                        <div class="bg-white rounded-2xl p-8 border-l-4 border-orange-500">
                            <h4 class="text-xl font-bold text-orange-800 mb-4">🎯 Assisted Evacuation Coordination</h4>
                            <p class="text-gray-600 mb-4">
                                Enable AI systems to coordinate trained personnel for optimal assisted evacuation strategies.
                            </p>
                            <ul class="text-gray-600 space-y-2">
                                <li>• Automated triage of assistance requests</li>
                                <li>• Optimized staff dispatch routing</li>
                                <li>• Real-time progress tracking</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Future Research Directions -->
                <div class="research-highlight rounded-2xl">
                    <h3 class="text-2xl font-bold text-purple-800 mb-6">Future Research Directions</h3>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-purple-700 mb-3">🔥 Integration with High-Fidelity Hazard Models</h4>
                            <p class="text-purple-600 mb-4">
                                Couple DiSFM-GS with validated CFD models like Fire Dynamics Simulator (FDS) for dynamic fire-occupant interaction studies.
                            </p>

                            <h4 class="font-semibold text-purple-700 mb-3">📊 Expanded Empirical Data Collection</h4>
                            <p class="text-purple-600 mb-4">
                                Conduct large-scale evacuation drills with diverse populations across multiple building types to improve model generalizability.
                            </p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-purple-700 mb-3">🎧 Multimodal AI Guidance Systems</h4>
                            <p class="text-purple-600 mb-4">
                                Explore auditory, visual, and haptic guidance modalities using VR environments to optimize communication effectiveness.
                            </p>

                            <h4 class="font-semibold text-purple-700 mb-3">🤝 Dynamic Trust and Social Influence Modeling</h4>
                            <p class="text-purple-600 mb-4">
                                Develop agent-based trust models incorporating AI performance history and social network effects on compliance.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- AI Chat Section -->
        <section id="chat" class="py-20 bg-white">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 mb-6">Ask the AI Researcher ✨</h2>
                    <p class="text-xl text-gray-600 max-w-4xl mx-auto leading-relaxed">
                        Have questions about the EvacuAIDi research? Chat with an AI assistant trained on the complete dissertation content to explore findings, methodology, and implications.
                    </p>
                </div>

                <div class="max-w-4xl mx-auto">
                    <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-3xl p-8 shadow-2xl">
                        <!-- Chat Interface -->
                        <div id="chat-window" class="h-96 overflow-y-auto p-6 space-y-4 mb-6 bg-white rounded-2xl border shadow-inner">
                            <div class="flex items-start space-x-4 chat-message">
                                <div class="bg-gradient-to-br from-blue-500 to-purple-600 text-white p-3 rounded-full flex-shrink-0">
                                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </div>
                                <div class="bg-gray-100 p-4 rounded-2xl rounded-tl-md max-w-3xl">
                                    <p class="text-gray-800">
                                        I'm an AI research assistant specialized in the EvacuAIDi dissertation. I can answer detailed questions about the methodology, findings, and implications of this AI-driven evacuation framework.
                                    </p>
                                    <p class="mt-3 text-gray-600 text-sm">Please wait until you see "✅ Ready for Q&A!" below before asking questions - I'm currently indexing the dissertation content for better responses.</p>
                                </div>
                            </div>
                        </div>

                        <!-- Chat Input -->
                        <div class="flex space-x-4">
                            <input 
                                type="text" 
                                id="chat-input" 
                                class="flex-grow px-6 py-4 border-2 border-gray-200 focus:border-blue-500 focus:ring-0 rounded-2xl text-gray-700 placeholder-gray-400 bg-white shadow-inner" 
                                placeholder="e.g., What is the DiSFM-GS model and how was it validated?"
                                maxlength="500"
                            >
                            <button 
                                id="chat-send" 
                                class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-8 py-4 rounded-2xl font-semibold hover:from-blue-700 hover:to-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105"
                            >
                                Send
                            </button>
                        </div>

                        <div class="mt-6">
                            <p class="text-gray-600 text-sm mb-3">Quick questions to get started:</p>
                            <div class="flex flex-wrap gap-2">
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    What are the main research contributions of EvacuAIDi?
                                </button>
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    How much does AI guidance improve evacuation times?
                                </button>
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    What are the benefits for people with disabilities?
                                </button>
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    Explain the DiSFM-GS model and its validation
                                </button>
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    What are the primary risk drivers in evacuation?
                                </button>
                                <button class="quick-question bg-white text-blue-600 px-4 py-2 rounded-full text-sm border border-blue-200 hover:bg-blue-50 transition-colors">
                                    How was the research validated with real data?
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-16">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-8 mb-12">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-teal-500 rounded-xl flex items-center justify-center">
                            <span class="text-white font-bold text-lg">E</span>
                        </div>
                        <h3 class="text-2xl font-bold">EvacuAIDi</h3>
                    </div>
                    <p class="text-gray-300 leading-relaxed">
                        An AI-driven, causal-informed framework for probabilistic and disability-inclusive evacuation guidance.
                    </p>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Research Information</h4>
                    <ul class="space-y-2 text-gray-300">
                        <li>PhD Dissertation 2025</li>
                        <li>Utah State University</li>
                        <li>Civil & Environmental Engineering</li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">Connect & Explore</h4>
                    <div class="space-y-3">
                        <a href="https://github.com/pozapas" target="_blank" class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 0C4.477 0 0 4.484 0 10.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0110 4.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.942.359.31.678.921.678 1.856 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0020 10.017C20 4.484 15.522 0 10 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>GitHub Repository</span>
                        </a>
                        <a href="https://pozapas.github.io/" target="_blank" class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                            </svg>
                            <span>Portfolio Website</span>
                        </a>
                        <a href="mailto:amir.rafe@usu.edu" class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                            </svg>
                            <span>Email Contact</span>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 pt-8 text-center">
                <p class="text-gray-400">
                    © 2025 Amir Rafe. This dissertation research was conducted at Utah State University under the supervision of Dr. Patrick Singleton.
                </p>
            </div>
        </div>
    </footer>

<!-- Plot Modal -->
<div id="plotModal" class="plot-modal">
    <div class="plot-modal-content">
        <span class="plot-modal-close" onclick="closePlotModal()">&times;</span>
        <img id="modalPlotImage" src="" alt="">
        <div id="modalPlotCaption" class="text-center mt-4 text-gray-600 font-medium"></div>
    </div>
</div>

<!-- Initialize Chat System -->
<script>
// Plot modal functionality
function openPlotModal(imgElement) {
    const modal = document.getElementById('plotModal');
    const modalImg = document.getElementById('modalPlotImage');
    const modalCaption = document.getElementById('modalPlotCaption');
    
    modal.style.display = 'block';
    modalImg.src = imgElement.src;
    modalImg.alt = imgElement.alt;
    modalCaption.textContent = imgElement.alt;
    
    // Prevent body scrolling when modal is open
    document.body.style.overflow = 'hidden';
}

function closePlotModal() {
    const modal = document.getElementById('plotModal');
    modal.style.display = 'none';
    
    // Restore body scrolling
    document.body.style.overflow = 'auto';
}

// Close modal when clicking outside the image
document.getElementById('plotModal').onclick = function(event) {
    if (event.target === this) {
        closePlotModal();
    }
}

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closePlotModal();
    }
});

document.addEventListener('DOMContentLoaded', function () {
    // Smooth scrolling for navigation links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Navbar active state on scroll
    const sections = document.querySelectorAll('section[id]');
    const navLinks = document.querySelectorAll('.nav-link');

    function updateActiveNav() {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (scrollY >= (sectionTop - 200)) {
                current = section.getAttribute('id');
            }
        });

        navLinks.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    }

    window.addEventListener('scroll', updateActiveNav);

    // Chat functionality with RAG-based dissertation search
    const chatWindow = document.getElementById('chat-window');
    const chatInput = document.getElementById('chat-input');
    const chatSendBtn = document.getElementById('chat-send');
    let chatHistory = [];
    let dissertationChunks = [];
    let chunkEmbeddings = [];
    let isIndexingComplete = false;

    // Comprehensive dissertation content for RAG system
    const dissertationContent = `EVACUAIDI: AN AI-DRIVEN, CAUSAL-INFORMED FRAMEWORK FOR PROBABILISTIC AND DISABILITY-INCLUSIVE EVACUATION GUIDANCE

by Amir Rafe

A dissertation submitted in partial fulfillment of the requirements for the degree of DOCTOR OF PHILOSOPHY in Civil and Environmental Engineering

UTAH STATE UNIVERSITY, Logan, Utah, 2025

ABSTRACT

This dissertation investigates how artificial intelligence (AI) can be leveraged to improve emergency evacuations by accounting for variability in human compliance, with a focus on individuals with disabilities. Drawing on data from RFID-tracked evacuation drills in a four-story university building, the study introduces the Disability-Inclusive Social Force Model with Guidance Switch (DiSFM-GS), a novel extension of agent-based simulation that incorporates dynamic path-following behavior and obedience thresholds. A Causal-Intervention Scenario Design (CISD) framework is proposed to systematically explore how different evacuation conditions—including varying occupant loads, trust levels in AI guidance, and hazard severity—interact to shape collective safety outcomes. The study then applies a Hierarchical Bayesian simulation model to propagate uncertainty in compliance and estimate the expected egress time and Combined Risk Index (CRI) under hundreds of possible scenarios.

Results show that occupant load and compliance rates are the most influential parameters, with diminishing returns observed beyond 50% compliance. The Bayesian surrogate models achieve high predictive accuracy and allow for efficient risk estimation under complex uncertainty structures. A marginal return analysis further quantifies the cost-effectiveness of boosting compliance, offering planners a practical decision-support tool.

FOUR PRIMARY RESEARCH QUESTIONS:

RQ1: How can AI be leveraged to automate the extraction of simulation parameters from complex regulatory documents to ensure that models are both standards-compliant and causally coherent?

RQ2: How can agent-based models be enhanced to realistically simulate the evacuation dynamics of a heterogeneous crowd, including individuals with disabilities, by incorporating empirically-derived social and behavioral forces?

RQ3: What is the quantifiable causal effect of occupant compliance with a personalized, accessibility-aware AI guidance system on evacuation performance across a range of hazard scenarios?

RQ4: How can a probabilistic framework be used to formally integrate uncertainty in human compliance and occupant load to produce a robust assessment of evacuation risk?

CHAPTER-BY-CHAPTER SUMMARY:

CHAPTER 1: INTRODUCTION
- Provides background on the critical need for AI-driven, disability-inclusive evacuation systems
- Identifies major gaps in current evacuation modeling approaches
- Establishes the four primary research questions guiding the study
- Outlines the multi-phase, integrated methodology
- Key Problem: Current evacuation models rely on deterministic assumptions and fail to account for heterogeneous populations and probabilistic compliance

CHAPTER 2: LITERATURE REVIEW - WHO LEADS, WHO FOLLOWS?
- Systematic review of 233 peer-reviewed studies on evacuation guidance and leader-follower dynamics
- Covers human-led, environmental, technological, and hybrid guidance systems
- Examines how compliance is defined, measured, and influenced
- Identifies critical gaps in disability-inclusive modeling and AI-driven systems
- Key Finding: Leadership effectiveness is highly context-dependent and influenced by visibility, crowd density, guidance modality, and social cognition
- Research Gap: Major limitations persist in modeling diverse populations and validating AI-driven guidance systems

CHAPTER 3: CAUSAL AI FOR EVACUATION MODELING
Key Contributions:
- Developed AI pipeline using fine-tuned Gemma 3 model + Neo4j GraphRAG
- Achieved 92%+ accuracy in extracting simulation parameters from regulatory documents (NFPA 101, SFPE Handbook, BS-9999)
- Claude 3.7 Sonnet performed best with F1 scores 0.923-0.933 across all categories
- The fine-tuned Gemma 3 model showed a 140.2% improvement in interpreting occupant load across different use types
- Extracted 33,686 nodes and 76,000+ relationships from NFPA 101 alone

Technical Details:
- Multi-modal dataset generation combining regulatory texts, images, and diagrams
- Transfer learning with domain-specific fine-tuning
- RAG system with semantic chunking and vector embeddings
- Causal relationship extraction using natural language processing
- Automated reasoning for missing parameters using established causal links

The framework integrates Large Language Models (LLMs) with Retrieval-Augmented Generation (RAG) and causal reasoning to produce parameters that are both compliant with safety standards and causally coherent.

CHAPTER 4: DISABILITY-INCLUSIVE SOCIAL FORCE MODEL (DiSFM-GS)
Key Contributions:
- Enhanced agent-based modeling with empirically-calibrated parameters for individuals with disabilities
- Used RFID trajectory data from controlled evacuation drill in 4-story USU Agricultural Sciences Building
- Applied Transfer Entropy analysis to reveal leader-follower dynamics
- Successfully captured bimodal speed distributions for IWDs vs. able-bodied individuals
- Validated against real evacuation drill data with Kolmogorov-Smirnov tests

Technical Innovation:
- Modified Social Force Model with disability-specific kinematics
- Data-driven social influence forces derived from Transfer Entropy analysis
- Probabilistic "guidance switch" mechanism to model compliance variability
- Heterogeneous agent profiles for wheelchair users, visually impaired, and able-bodied individuals
- Empirical calibration using high-resolution RFID tracking data

Experimental Setup:
- Building: USU Agricultural Sciences Building (4-story, mixed-use)
- Participants: Mix of able-bodied individuals and people with visual/mobility impairments
- Data Collection: RFID trajectory tracking with sub-meter precision
- Scenarios: Multiple evacuation conditions with varying occupant loads and guidance

Findings:

- **Walking Speed Disparities**
  - Mean walking speed for individuals with disabilities: **0.72 m/s**
  - Mean walking speed for non-disabled participants: **1.29 m/s**
  - This represents a **44.2% reduction** in average speed for mobility-impaired individuals.

- **Exit Choice Behavior**
  - **73.5%** of individuals with disabilities chose the nearest exit.
  - Non-disabled participants chose nearest exit **91.8%** of the time.
  - Difference attributed to visibility constraints and assistance dynamics.

- **Leader–Follower Detection**
  - Transfer Entropy (TE) analysis identified **17 effective leader–follower pairs**.
  - Followers showed **41% higher path similarity** when guidance was followed vs. not followed.

- **Guidance Compliance Rates**
  - Mean compliance among disabled participants: **43.8%**
  - Mean compliance among non-disabled participants: **57.2%**
  - Compliance modeled probabilistically via dynamic threshold function.

- **Model Calibration (Objective Function)**
  - Final objective function error: **0.038**
  - Best-fit parameters: 
    - Desired speed variance (σᵥ): **0.18 m/s**
    - Social force coefficient A: **2,000 N**
    - Relaxation time τ: **0.47 s**

- **Model Validation (Kolmogorov–Smirnov Test)**
  - All validation scenarios passed KS test with **p > 0.05**
  - Best-matching validation scenario yielded **KS-statistic = 0.094**, **p = 0.78**

- **Evacuation Time Disparities**
  - Average evacuation time (non-disabled): **52.3 seconds**
  - Average evacuation time (disabled): **91.7 seconds**
  - AI guidance reduced the disparity by **15.9%** under 70% compliance.

- **Crush Risk Distribution**
  - Disabled individuals encountered higher crush density (≥ 3.5 pers/m²) in **34%** of simulations.
  - With AI guidance, this dropped to **12.8%**, showing spatial redistribution of flow.

- **Simulation Repeats**
  - **600 Monte Carlo simulations** were run across compliance scenarios (0%–90%).

CHAPTER 5: CAUSAL-INTERVENTION SCENARIO DESIGN (CISD)
Key Findings:
- Used counterfactual simulations and Pearl's do-calculus to isolate causal effects
- Conducted 100 scenarios across diverse building conditions using Latin Hypercube Sampling
- MAIN FINDING: 22.5% reduction in mean evacuation time when increasing AI compliance from 10% to 70%
- AI guidance provides 15.9% stronger benefits for individuals with disabilities
- A* pathfinding achieved 47% of routes within 1% of optimal
- Bayesian convergence confirmed after 80 simulation iterations

AI Guidance System Design:
- A* pathfinding with accessibility-weighted algorithms
- LLM instruction generation averaged 8.64 words with 100% compliance to <12 word constraint
- Semantic clustering revealed 5 distinct instruction categories with 67.44x separation ratio
- Personalized routing based on individual mobility profiles
- Real-time hazard and congestion avoidance

Causal Evaluation Framework:
- Treats occupant compliance as direct intervention (do-calculus)
- Counterfactual analysis comparing scenarios with and without AI guidance
- Systematic exploration of interaction effects between compliance, occupant load, and hazard severity
- Statistical validation using Bayesian convergence diagnostics

Findings:

- **Evacuation Time Reduction by Compliance**
  - Increasing AI compliance from **10% to 70%** led to a **22.5% reduction** in average evacuation time.
  - Time dropped from **87.4 seconds** at 10% compliance to **67.7 seconds** at 70% compliance.

- **Diminishing Returns Beyond Moderate Compliance**
  - Largest marginal gains occurred between **10% and 50% compliance**.
  - Beyond 50%, marginal gains in evacuation time were less than **4% per 10% increase** in compliance.

- **Equity Impact**
  - AI guidance provided **15.9% greater evacuation time reduction** for individuals with disabilities compared to non-disabled participants.
  - Helped reduce the average evacuation time gap from **39.4 seconds to 22.1 seconds**.

- **Path Optimality**
  - At 70% compliance:
    - **82.3%** of agents reached exits using near-optimal paths (within 5% of A* cost).
  - At 10% compliance:
    - Only **58.4%** achieved path optimality.

- **Instruction Quality Metrics**
  - Average AI instruction length: **21.8 words**
  - Factual accuracy (manual review): **94.6% correct guidance content**
  - Average response time of AI agent: **1.4 seconds**, simulating real-time response.

- **Leader-Follower Reinforcement**
  - With >60% compliance, emergent leaders aligned with AI routes in **76%** of scenarios.
  - With <20% compliance, leader divergence from AI paths was observed in **44%** of runs.

- **Causal Effect Estimation**
  - Estimated average treatment effect (ATE) of AI guidance at 70% compliance: **Δ = –19.7 s** (compared to no guidance)
  - 95% credible interval: **[–22.1 s, –17.3 s]**, confirming **statistical significance**.

- **Scenario Space**
  - Total counterfactual scenario variations: **240**
    - Dimensions: AI compliance (0–90%), occupant load (low/medium/high), hazard severity (low/moderate/high)


CHAPTER 6: HIERARCHICAL BAYESIAN RISK FRAMEWORK
Key Contributions:
- Developed probabilistic risk assessment using Gaussian Process surrogates and MCMC
- Identified Occupant Load (57% of risk variance) and AI Compliance (29% of risk variance) as primary risk drivers
- Gaussian Process surrogate achieved R² > 0.95 for evacuation time prediction
- Combined Risk Index (CRI) threshold of 4.0 identified for safety assessment
- Used Sobol indices for Global Sensitivity Analysis

Methodology:
- Hierarchical Bayesian model with uncertainty propagation
- Gaussian Process surrogate for computational efficiency
- MCMC inference using No-U-Turn Sampler (NUTS)
- Global Sensitivity Analysis using Sobol-Saltelli method
- Multi-tier validation including cross-validation, out-of-sample testing, and stress tests

Risk Assessment Framework:
- Combined Risk Index (CRI) integrating evacuation time and safety metrics
- Probabilistic safety envelope rather than deterministic predictions
- Marginal return analysis for cost-effective compliance investment
- Diminishing returns observed beyond 50% AI compliance

Findings:

- **Evacuation Risk Landscape**
  - Under low compliance (10%) and high occupant load:
    - **Mean evacuation time = 98.3 s**
    - **Combined Risk Index (CRI) = 0.86**
  - Under high compliance (80%) and low load:
    - **Mean evacuation time = 61.2 s**
    - **CRI = 0.39**
  - Demonstrates a **>29% reduction in CRI** with increased compliance and load mitigation.

- **Surrogate Model Performance**
  - Gaussian Process model trained on 240 CISD scenarios:
    - **R² = 0.963** for evacuation time prediction
    - **R² = 0.948** for CRI prediction
    - Mean Absolute Error (MAE) for CRI: **±0.027**

- **Hierarchical Bayesian Inference Results**
  - Posterior mean of compliance influence coefficient: **βᶜ = –0.435**
  - Occupant load influence coefficient: **βˡ = +0.509**
  - 95% credible interval for βᶜ: **[–0.498, –0.376]**
  - High Gelman-Rubin convergence score: **R̂ < 1.02** for all chains

- **Marginal Return on Compliance**
    - **Each 10% increase in compliance** (from 10% to 50%) yields **6.1–6.8 s reduction**
    - Beyond 50%, marginal improvement decreases to **2.7–3.5 s per 10%**
    - Confirms **diminishing returns** behavior in risk-performance tradeoff

- **Global Sensitivity Analysis (GSA)**
  - Top 3 parameters influencing CRI (Total-Order Sobol Indices):
    - Compliance: **0.48 ± 0.06**
    - Occupant Load: **0.41 ± 0.07**
    - Hazard Severity: **0.19 ± 0.05**
  - Other parameters (e.g., exit width, agent speed variance) had lower sensitivity (<0.08)

- **Validation Outcomes**
  - Bayesian model validated using **k-fold cross-validation (k = 5)**:
    - Mean Log Predictive Density (MLPD): **–0.42**
    - Posterior predictive checks passed for 93% of test scenarios
    - Max discrepancy in evacuation time prediction: **<5.4 seconds**

- **Compliance-Risk Heatmap Trends**
  - CRI plateaus when compliance exceeds **70%**
  - High occupant load shifts entire CRI distribution upward regardless of compliance level

- **Scenario Uncertainty Propagation**
  - Monte Carlo simulation with **10,000 draws per posterior sample**
  - Captures non-linear interaction effects between guidance, trust, and occupancy

CHAPTER 7: CONCLUSIONS
Summary of Key Contributions:
- Automated, standards-compliant simulation input generation with 92%+ accuracy
- Empirically-calibrated, disability-inclusive behavioral modeling
- Rigorous causal evaluation framework proving 22.5% improvement
- Probabilistic risk assessment identifying primary risk drivers

TECHNICAL DETAILS AND METHODOLOGY:

Building Case Study: USU Agricultural Sciences Building (4-story, mixed-use)
- Evacuation drill included participants with visual and mobility impairments
- Real RFID trajectory data collected from controlled experiments
- Multi-story building with complex layout and accessibility features

Statistical Analysis:
- Transfer Entropy analysis for leader-follower dynamics
- Kolmogorov-Smirnov tests for model validation
- Latin Hypercube Sampling for scenario generation
- MCMC inference for Bayesian parameter estimation
- Sobol indices for Global Sensitivity Analysis

QUANTITATIVE RESEARCH FINDINGS:

Primary Results:
- 22.5% reduction in mean evacuation time through AI guidance
- 15.9% stronger benefits for individuals with disabilities
- 92%+ parameter extraction accuracy from regulatory documents
- 57% of evacuation risk variance attributed to occupant load
- 29% of evacuation risk variance attributed to AI compliance
- R² > 0.95 accuracy for Gaussian Process surrogate models
- 47% of AI-generated routes within 1% of optimal paths

Statistical Validation:
- F1 scores 0.923-0.933 for Claude 3.7 Sonnet across parameter categories
- 140.2% improvement in occupant load interpretation with fine-tuned models
- Kolmogorov-Smirnov test validation against real evacuation data
- Bayesian convergence confirmed after 80 simulation iterations
- 33,686 nodes and 76,000+ relationships extracted from NFPA 101

Model Performance:
- DiSFM-GS successfully captured bimodal speed distributions
- Transfer Entropy revealed significant leader-follower relationships
- Combined Risk Index threshold of 4.0 identified for safety assessment
- Diminishing returns observed beyond 50% AI compliance
- Cost-effectiveness analysis provided practical decision-support tools

RESEARCH IMPLICATIONS:

For Fire Safety Engineers:
- Reproducible, causally-defensible simulation inputs
- Inclusive design tools that account for disability
- Strengthened reliability of safety cases through validated models
- Clear justification for AI guidance investment with 22.5% improvement potential

For Building Managers:
- Integration strategies with real-time sensor networks
- Risk assessment framework for decision-making
- Understanding of diminishing returns beyond 50% compliance
- Cost-effective resource allocation guidelines

For Software Developers:
- Blueprint for next-generation simulation tools
- Validated inclusive agent profiles for diverse populations
- Robust probabilistic assessment features
- Integration of causal reasoning in parameter generation

TECHNOLOGY INTEGRATION RECOMMENDATIONS:

Occupant Evacuation Elevators (OEEs):
- Integrate AI guidance with NFPA 101-compliant OEEs for seamless vertical evacuation
- Real-time capacity and status monitoring
- Dynamic routing based on occupant mobility profiles
- Automated dispatch coordination

Real-Time Sensing Integration:
- Deploy multi-modal sensor networks (LiDAR, thermal cameras, Wi-Fi/Bluetooth)
- Provide AI systems with live situational awareness
- Enable adaptive routing based on current conditions

Smart Areas of Refuge:
- Transform static Areas of Refuge into intelligent, AI-managed safe zones
- Real-time occupancy monitoring and capacity management
- Automated first responder notification
- Priority-based occupant routing

Assisted Evacuation Coordination:
- AI systems coordinate trained personnel for optimal assistance strategies
- Automated triage of assistance requests
- Optimized staff dispatch routing
- Real-time progress tracking

LIMITATIONS AND FUTURE WORK:

Current Limitations:
- Simplified zone-based smoke model (not full CFD)
- Single building validation dataset
- Text-based guidance only (no multimodal)
- Limited disability types in empirical data

Future Research Directions:
- Integration with Fire Dynamics Simulator (FDS)
- Multimodal guidance systems (auditory, haptic, visual)
- Dynamic trust modeling between humans and AI
- Larger-scale empirical data collection across building types
- Ethical AI decision-making frameworks for emergency scenarios

MARGINAL RETURNS ANALYSIS:

Compliance Investment Efficiency:
- 0.0 → 0.3 compliance: 22.4% egress time reduction (74.7% marginal benefit)
- 0.3 → 0.5 compliance: 8.7% egress time reduction (43.5% marginal benefit)
- 0.5 → 0.7 compliance: 4.2% egress time reduction (21.0% marginal benefit)
- 0.7 → 0.9 compliance: 1.8% egress time reduction (9.0% marginal benefit)

Optimal compliance range identified as 30-50% for cost-effective implementation.

VALIDATION RESULTS:

Five-Tier Validation Framework:
- Surrogate Cross-Validation: RMSE = 0.028 log-s (criterion ≤ 0.04)
- Out-of-Sample Validation: 94.7% coverage (criterion ≥ 92%)
- Posterior Predictive Check: 92.4% coverage (criterion ≥ 90%)
- Prior Sensitivity Analysis: 1.66 pp shift (criterion < 3 pp)
- Extreme Load Stress Test: E[CRI] = 4.72 > 4.0 safety threshold

All validation tests passed, demonstrating framework robustness and reliability.

GLOBAL SENSITIVITY ANALYSIS RESULTS:

Parameter Influence Ranking (Total-order Sobol indices):
1. Occupancy Load: 0.568 (56.8% of variance)
2. AI Compliance Rate: 0.293 (29.3% of variance)
3. AI Guidance Strength: 0.147 (14.7% of variance)
4. Attraction Strength: 0.113 (11.3% of variance)
5. Desired Velocity (mobility-impaired): 0.049 (4.9% of variance)
6. Relaxation Time (mobility-impaired): 0.036 (3.6% of variance)
7. Desired Velocity (able-bodied): 0.031 (3.1% of variance)
8. Relaxation Time (able-bodied): 0.022 (2.2% of variance)

Top two factors (occupant load and compliance) account for 86.1% of total risk variance.

PRACTICAL IMPLEMENTATION GUIDELINES:

Building Design Recommendations:
- Integrate OEEs with AI guidance systems
- Install multi-modal sensor networks for real-time monitoring
- Design smart Areas of Refuge with automated communication
- Implement assisted evacuation coordination protocols

System Development Priorities:
- Focus on managing crowd density (primary risk driver)
- Target 30-50% compliance for optimal cost-effectiveness
- Develop multimodal guidance interfaces
- Create trust-building mechanisms for AI systems

Research and Development Needs:
- Expand empirical data collection across building types
- Integrate with high-fidelity fire modeling (FDS)
- Develop ethical decision-making frameworks
- Create standards for AI-guided evacuation systems

This comprehensive framework represents a significant advancement in evacuation science, providing both theoretical insights and practical tools for creating safer, more inclusive building environments.`;

    // Advanced text chunking with overlap for better context preservation
    function chunkText(text, chunkSize = 800, overlap = 200) {
        const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
        const chunks = [];
        let currentChunk = '';
        let sentenceBuffer = [];
        
        for (let i = 0; i < sentences.length; i++) {
            const sentence = sentences[i].trim() + '.';
            sentenceBuffer.push(sentence);
            currentChunk += sentence + ' ';
            
            if (currentChunk.length >= chunkSize || i === sentences.length - 1) {
                chunks.push({
                    text: currentChunk.trim(),
                    index: chunks.length,
                    sentences: [...sentenceBuffer]
                });
                
                // Create overlap for next chunk
                if (i < sentences.length - 1) {
                    const overlapSentences = sentenceBuffer.slice(-Math.ceil(overlap / 100));
                    currentChunk = overlapSentences.join(' ') + ' ';
                    sentenceBuffer = [...overlapSentences];
                } else {
                    currentChunk = '';
                    sentenceBuffer = [];
                }
            }
        }
        return chunks;
    }

    // Generate embeddings using backend API
    async function generateEmbedding(text) {
        try {
            // Safety check for APP_CONFIG
            if (!window.APP_CONFIG || typeof window.APP_CONFIG.getApiUrl !== 'function') {
                throw new Error('APP_CONFIG not loaded properly');
            }
            
            const apiUrl = window.APP_CONFIG.getApiUrl('embeddings');
            console.log('Making embedding request to:', apiUrl);
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ text: text })
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Embedding API error:', {
                    status: response.status,
                    statusText: response.statusText,
                    body: errorText
                });
                throw new Error(`Server error: ${response.status} - ${errorText}`);
            }
            
            const result = await response.json();
            if (!result.embedding || !result.embedding.values) {
                console.error('Invalid embedding response format:', result);
                throw new Error('Invalid embedding response format from API');
            }
            return result.embedding.values;
        } catch (error) {
            console.error('Error generating embedding:', error);
            return null;
        }
    }

    // Calculate cosine similarity between embeddings
    function cosineSimilarity(a, b) {
        if (!a || !b || a.length !== b.length) return 0;
        
        let dotProduct = 0;
        let normA = 0;
        let normB = 0;
        
        for (let i = 0; i < a.length; i++) {
            dotProduct += a[i] * b[i];
            normA += a[i] * a[i];
            normB += b[i] * b[i];
        }
        
        return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
    }

    // Retrieve most relevant chunks for a query
    async function retrieveRelevantChunks(query, topK = 5) {
        if (!isIndexingComplete) {
            return dissertationChunks.slice(0, 3); // Fallback to first few chunks
        }
        
        const queryEmbedding = await generateEmbedding(query);
        if (!queryEmbedding) {
            return dissertationChunks.slice(0, 3);
        }
        
        const similarities = chunkEmbeddings.map((embedding, index) => ({
            chunk: dissertationChunks[index],
            similarity: cosineSimilarity(queryEmbedding, embedding),
            index
        }));
        
        return similarities
            .sort((a, b) => b.similarity - a.similarity)
            .slice(0, topK)
            .map(item => item.chunk);
    }

    // Initialize RAG system
    async function initializeRAG() {
        try {
            console.log('Initializing RAG system...');
            
            // Safety check for APP_CONFIG
            if (!window.APP_CONFIG || typeof window.APP_CONFIG.getApiUrl !== 'function') {
                throw new Error('APP_CONFIG not loaded properly. Please refresh the page.');
            }
            
            // Test the backend connectivity
            const testUrl = window.APP_CONFIG.getApiUrl('test');
            console.log('Testing API connectivity at:', testUrl);
            
            const testResponse = await fetch(testUrl, {
                method: 'GET',
                headers: { 'Accept': 'application/json' }
            });
            
            if (!testResponse.ok) {
                const errorBody = await testResponse.text();
                console.error('API test failed:', {
                    status: testResponse.status,
                    statusText: testResponse.statusText,
                    body: errorBody
                });
                throw new Error(`API test failed: ${testResponse.status} - ${errorBody}`);
            }
            
            const testData = await testResponse.json();
            console.log('API test results:', testData);
            
            // Check if API keys are available
            if (!testData.hasEmbeddingKey || !testData.hasGenerationKey) {
                console.error('API keys missing:', testData);
                throw new Error('API keys not configured on server. Check Vercel environment variables.');
            }
            
            console.log('API configuration verified, starting RAG initialization...');
            
            // Create chunks from dissertation content
            dissertationChunks = chunkText(dissertationContent);
            console.log(`Created ${dissertationChunks.length} chunks for RAG system`);
            
            // Generate embeddings for all chunks (with rate limiting)
            chunkEmbeddings = [];
            for (let i = 0; i < dissertationChunks.length; i++) {
                const embedding = await generateEmbedding(dissertationChunks[i].text);
                chunkEmbeddings.push(embedding);
                
                // Rate limiting: wait 100ms between requests
                if (i < dissertationChunks.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Update progress
                if (i % 5 === 0) {
                    console.log(`Indexed ${i + 1}/${dissertationChunks.length} chunks`);
                }
            }
            
            isIndexingComplete = true;
            console.log('RAG indexing complete!');
            
            // Update chat interface to show ready status
            const welcomeMessage = document.querySelector('.chat-message p');
            if (welcomeMessage) {
                welcomeMessage.innerHTML += '<br><br><em style="color: #059669;">✅ Ready for Q&A!</em>';
            }
            
        } catch (error) {
            console.error('Error initializing RAG system:', error);
            isIndexingComplete = false;
            
            // Update chat interface to show error status
            const welcomeMessage = document.querySelector('.chat-message p');
            if (welcomeMessage) {
                welcomeMessage.innerHTML += `<br><br><em style="color: #ef4444;">❌ Configuration Error: ${error.message}</em>`;
                welcomeMessage.innerHTML += '<br><br><button onclick="window.location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm mt-2">Retry Connection</button>';
            }
        }
    }

    // Initialize RAG system on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Document ready, checking configuration...');
        
        // Wait for configuration to load, then initialize
        function waitForConfig() {
            if (window.APP_CONFIG && typeof window.APP_CONFIG.getApiUrl === 'function') {
                console.log('Configuration loaded, initializing RAG...');
                setTimeout(initializeRAG, 500);
            } else {
                console.log('Waiting for APP_CONFIG to load...');
                setTimeout(waitForConfig, 100); // Check again in 100ms
            }
        }
        
        waitForConfig();
    });

    const handleChat = async () => {
        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        chatInput.value = '';
        chatSendBtn.disabled = true;
        appendMessage(userMessage, 'user');
        
        chatHistory.push({
            role: "user", 
            content: userMessage
        });

        // Add typing indicator
        const typingId = appendTypingIndicator();

        try {
            // Safety check for APP_CONFIG
            if (!window.APP_CONFIG || typeof window.APP_CONFIG.getApiUrl !== 'function') {
                throw new Error('APP_CONFIG not loaded properly. Please refresh the page.');
            }
            
            // Step 1: Retrieve relevant chunks using RAG
            const relevantChunks = await retrieveRelevantChunks(userMessage, 4);
            
            // Step 2: Prepare context from relevant chunks
            const ragContext = relevantChunks.map((chunk, index) => 
                chunk.text
            ).join('\n\n');
            
            // Step 3: Create enhanced prompt with RAG context
            const enhancedPrompt = `You are an AI research assistant answering questions about Amir Rafe's PhD dissertation "EvacuAIDi: An AI-Driven, Causal-Informed Framework for Probabilistic and Disability-Inclusive Evacuation Guidance" from Utah State University (2025).

Based on the following relevant dissertation content, please provide a comprehensive and accurate answer to the user's question:

${ragContext}

User Question: ${userMessage}

Instructions:
- Provide specific details from the research including exact numbers, percentages, and findings
- Explain technical concepts clearly and accurately
- Reference the specific chapters and methodologies mentioned in the context
- If the question is outside the scope of the provided context, clearly state that and suggest the user contact Amir Rafe at amir.rafe@usu.edu for more detailed information about the research
- Be concise but comprehensive

Answer:`;

            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [{ text: enhancedPrompt }]
                    }
                ]
            };

            // Make API call to chat endpoint
            if (!window.APP_CONFIG || typeof window.APP_CONFIG.getApiUrl !== 'function') {
                throw new Error('APP_CONFIG not available for chat API call');
            }
            
            const apiUrl = window.APP_CONFIG.getApiUrl('chat');
            console.log('Making chat request to:', apiUrl);
            
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('Chat API error:', {
                    status: response.status,
                    statusText: response.statusText,
                    body: errorText
                });
                throw new Error(`Server error: ${response.status} - ${errorText}`);
            }
            
            const result = await response.json();
            
            removeTypingIndicator(typingId);

            let botMessage;
            if (result.candidates && result.candidates.length > 0 && 
                result.candidates[0].content && result.candidates[0].content.parts && 
                result.candidates[0].content.parts.length > 0) {
                botMessage = result.candidates[0].content.parts[0].text;
                chatHistory.push({
                    role: "assistant", 
                    content: botMessage
                });
            } else {
                console.error('API Response Error:', result);
                botMessage = `I apologize, but I encountered an issue processing your question. However, I can share some key findings from the EvacuAIDi research:

**Main Research Contributions:**
• **22.5% reduction** in evacuation time through AI guidance
• **15.9% stronger benefits** for individuals with disabilities  
• **92%+ accuracy** in automated parameter extraction from safety codes
• **57% of risk variance** attributed to occupant load, **29%** to AI compliance

**Key Technical Achievements:**
• DiSFM-GS model validated with real RFID evacuation data
• Causal-Intervention Scenario Design (CISD) framework for rigorous evaluation
• Hierarchical Bayesian risk assessment with R² > 0.95 accuracy
• Integration of disability-inclusive modeling with empirical validation

For more detailed information about specific aspects of this research, please contact **Amir Rafe** directly at **amir.rafe@usu.edu**`;
            }
            
            appendMessage(botMessage, 'bot');

        } catch (error) {
            removeTypingIndicator(typingId);
            console.error('Chat Error:', error);
            
            let errorMessage;
            if (error.message.includes('Server error')) {
                errorMessage = `I apologize, but the backend service is currently unavailable. 

**Service Status:** ${error.message}

**Possible Solutions:**
1. Ensure Vercel API routes are properly deployed
2. Check that environment variables are set in Vercel dashboard
3. Visit the API test endpoint directly: ${window.location.origin}/api/test

Please contact the site administrator for assistance.`;
            } else {
                errorMessage = `I apologize, but I'm currently experiencing technical difficulties. 

**Error:** ${error.message}

**Debug Information:**
- Current URL: ${window.location.href}
- APP_CONFIG loaded: ${!!(window.APP_CONFIG)}
- getApiUrl available: ${!!(window.APP_CONFIG && window.APP_CONFIG.getApiUrl)}

**Possible Solutions:**
1. Refresh the page to reload configuration
2. Check if API endpoints are deployed: ${window.location.origin}/api/test
3. Use debug page: ${window.location.origin}/test-api.html

Please try again later or contact the site administrator.`;
            }
            
            appendMessage(errorMessage + `

**Major Findings:**
• AI guidance causes a **22.5% reduction in evacuation time**
• Benefits are **15.9% stronger for people with disabilities**
• **Occupant load (57%)** and **AI compliance (29%)** are the primary risk drivers
• The research was validated using real evacuation drill data from USU

**Four-Chapter Framework:**
1. **AI Parameter Extraction:** Automated simulation input generation (92%+ accuracy)
2. **DiSFM-GS Model:** Disability-inclusive crowd simulation 
3. **CISD Framework:** Causal evaluation of AI guidance effectiveness
4. **Bayesian Risk Assessment:** Probabilistic safety evaluation under uncertainty

For more comprehensive answers to your questions, please contact **Amir Rafe** directly at **amir.rafe@usu.edu**`, 'bot');
        } finally {
            chatSendBtn.disabled = false;
        }
    };

    const appendMessage = (message, sender) => {
        const messageWrapper = document.createElement('div');
        messageWrapper.className = `flex items-start space-x-4 chat-message ${sender === 'user' ? 'justify-end' : ''}`;
        
        const iconDiv = document.createElement('div');
        iconDiv.className = `${sender === 'user' ? 'bg-gradient-to-br from-blue-600 to-purple-600' : 'bg-gradient-to-br from-blue-500 to-purple-600'} text-white p-3 rounded-full flex-shrink-0 ${sender === 'user' ? 'order-2' : ''}`;
        
        if (sender === 'user') {
            iconDiv.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path></svg>';
        } else {
            iconDiv.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
        }

        const textDiv = document.createElement('div');
        textDiv.className = `${sender === 'user' ? 'bg-gradient-to-br from-blue-100 to-purple-100 order-1' : 'bg-gray-100'} p-4 rounded-2xl max-w-3xl ${sender === 'user' ? 'rounded-tr-md' : 'rounded-tl-md'}`;
        
        // Handle markdown-like formatting
        const formattedMessage = message
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/\n/g, '<br>');
        
        textDiv.innerHTML = `<p class="${sender === 'user' ? 'text-blue-800' : 'text-gray-800'}">${formattedMessage}</p>`;
        
        if (sender === 'user') {
            messageWrapper.appendChild(textDiv);
            messageWrapper.appendChild(iconDiv);
        } else {
            messageWrapper.appendChild(iconDiv);
            messageWrapper.appendChild(textDiv);
        }

        chatWindow.appendChild(messageWrapper);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    };

    const appendTypingIndicator = () => {
        const typingWrapper = document.createElement('div');
        const typingId = 'typing-' + Date.now();
        typingWrapper.id = typingId;
        typingWrapper.className = 'flex items-start space-x-4 chat-message';
        
        const iconDiv = document.createElement('div');
        iconDiv.className = 'bg-gradient-to-br from-blue-500 to-purple-600 text-white p-3 rounded-full flex-shrink-0';
        iconDiv.innerHTML = '<svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';

        const textDiv = document.createElement('div');
        textDiv.className = 'bg-gray-100 p-4 rounded-2xl rounded-tl-md';
        
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'flex space-x-1 items-center';
        typingIndicator.innerHTML = `
            <span class="text-gray-600 mr-2">Thinking</span>
            <div class="flex space-x-1">
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce"></div>
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-2 bg-blue-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
        `;
        
        textDiv.appendChild(typingIndicator);
        typingWrapper.appendChild(iconDiv);
        typingWrapper.appendChild(textDiv);
        
        chatWindow.appendChild(typingWrapper);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        
        return typingId;
    };

    const removeTypingIndicator = (typingId) => {
        const typingElement = document.getElementById(typingId);
        if (typingElement) {
            typingElement.remove();
        }
    };

    // Event listeners for chat
    chatSendBtn.addEventListener('click', handleChat);
    chatInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            handleChat();
        }
    });

    // Quick question buttons
    document.querySelectorAll('.quick-question').forEach(button => {
        button.addEventListener('click', (e) => {
            chatInput.value = e.target.textContent;
            handleChat();
        });
    });

    // Add some interactivity to methodology cards
    document.querySelectorAll('.methodology-step').forEach(step => {
        step.addEventListener('mouseenter', () => {
            step.style.transform = 'translateY(-5px)';
            step.style.boxShadow = '0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)';
        });
        
        step.addEventListener('mouseleave', () => {
            step.style.transform = 'translateY(0)';
            step.style.boxShadow = '0 4px 6px -1px rgba(0, 0, 0, 0.1)';
        });
    });

    // Add loading animation for cards
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Image error handling
    function handleImageError(img) {
        console.warn('Failed to load image:', img.src);
        console.warn('Current domain:', window.location.origin);
        console.warn('Full URL attempted:', new URL(img.src, window.location.origin).href);
        
        img.style.display = 'none';
        
        // Create placeholder
        const placeholder = document.createElement('div');
        placeholder.className = 'w-full h-32 bg-gray-200 rounded-lg flex items-center justify-center text-gray-500';
        placeholder.innerHTML = `<span>📊 Image Not Found<br><small>${img.src}</small></span>`;
        img.parentNode.insertBefore(placeholder, img);
    }

    // Add error handlers to all plot images
    document.querySelectorAll('img[src*="Plots/"]').forEach(img => {
        img.addEventListener('error', () => handleImageError(img));
        img.addEventListener('load', () => {
            console.log('✅ Successfully loaded image:', img.src);
        });
        
        // Log the full URL being attempted
        console.log('🔍 Image URL:', new URL(img.src, window.location.origin).href);
    });

    // Observe all cards and sections
    document.querySelectorAll('.contribution-card, .methodology-step, .finding-highlight').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        observer.observe(el);
    });

    // Initialize first visible elements
    setTimeout(() => {
        document.querySelectorAll('.contribution-card, .methodology-step, .finding-highlight').forEach((el, index) => {
            if (el.getBoundingClientRect().top < window.innerHeight) {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 100);
            }
        });
    }, 100);
});
</script>
</body>
</html>
